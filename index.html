<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Games Planet Order Form â€“ ETA Final</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    input, select, textarea {
      width: 90%; max-width: 400px; margin: 5px auto; padding: 10px;
      font-size: 16px; display: block; border-radius: 5px; border: 1px solid #ccc;
    }
    button {
      padding: 15px 25px; font-size: 18px; margin: 10px;
      border: none; border-radius: 5px; cursor: pointer;
    }
    .pay-btn { background-color: #00b9f5; color: white; }
    .order-btn { background-color: #28a745; color: white; }
    img { width: 250px; margin: 20px 0; }
    #deliveryEstimate { font-size: 16px; color: green; margin-top: 10px; white-space: pre-line; }
  </style>
</head>
<body>

<h1>GAMES PLANET</h1>
<h2>Manual Order Page â€“ Fill your details</h2>

<input type="text" id="name" placeholder="Name" required>
<input type="text" id="mobile" placeholder="Mobile" required>
<input type="text" id="altmobile" placeholder="Alt Mobile">
<input type="email" id="email" placeholder="Email">
<textarea id="address" placeholder="Address"></textarea>
<input type="text" id="landmark" placeholder="Landmark">
<input type="text" id="pincode" placeholder="Pincode">

<div id="deliveryEstimate"></div>

<input type="text" id="state" placeholder="State" readonly>
<input type="text" id="city" placeholder="District/City" readonly>

<select id="postoffice" required>
  <option value="">Select Post Office</option>
</select>

<input type="text" id="product" placeholder="Product">
<input type="text" id="variant" placeholder="Variant">
<input type="number" id="baseprice" placeholder="Base Price">
<input type="text" id="discount" placeholder="Discount Applied">
<input type="number" id="amountpaid" placeholder="Amount Paid">

<button class="pay-btn" onclick="payNow()">Pay Now</button>
<button class="order-btn" onclick="sendOrder()">Submit Order Now</button>

<img src="https://gamesplanet13.github.io/Ordernow/qr.jpg" alt="Paytm QR" id="qr-image"/>

<script>
let pincodeLatLng = {
  "342005": { "lat": 26.24, "lng": 73.02, "city": "Jodhpur", "state": "Rajasthan" },
  "110001": { "lat": 28.64, "lng": 77.22, "city": "New Delhi", "state": "Delhi" }
};

function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2)**2 +
            Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLon/2)**2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

function estimateDays(distance) {
  if (distance <= 30) return 1;
  else if (distance <= 60) return 2;
  else if (distance <= 100) return 3;
  else if (distance <= 200) return 4;
  else if (distance <= 500) return 5;
  else if (distance <= 1000) return 6;
  else if (distance <= 1500) return 7;
  else if (distance <= 2000) return 8;
  else if (distance <= 3000) return 10;
  else return 12;
}

function getEstDate(days) {
  let d = new Date();
  d.setDate(d.getDate() + days);
  return d.toLocaleDateString("en-IN", { day: "2-digit", month: "long", year: "numeric" });
}

document.getElementById("pincode").addEventListener("input", function(){
  let pincode = this.value;
  if (pincode.length === 6) {
    fetch(`https://api.postalpincode.in/pincode/${pincode}`)
    .then(res => res.json())
    .then(data => {
      if (data[0].Status === "Success") {
        let po = data[0].PostOffice[0];
        document.getElementById("state").value = po.State;
        document.getElementById("city").value = po.District;

        let sel = document.getElementById("postoffice");
        sel.innerHTML = '<option value="">Select Post Office</option>';
        data[0].PostOffice.forEach(p => {
          let opt = document.createElement("option");
          opt.value = p.Name;
          opt.text = p.Name;
          sel.appendChild(opt);
        });

        if (pincodeLatLng[pincode]) {
          const dest = pincodeLatLng[pincode];
          const distance = Math.round(haversine(28.8, 79.0, dest.lat, dest.lng));
          const eta = estimateDays(distance);
          const etaText = `${eta} day${eta > 1 ? "s" : ""}`;
          const estDate = getEstDate(eta);

          const finalText = `ðŸ“ Distance: ${distance} km\nâ³ ETA: ${etaText}\nðŸ“… Estimated Delivery: ${estDate}`;
          const de = document.getElementById("deliveryEstimate");
          de.innerText = finalText;
          de.dataset.final = finalText;
          de.dataset.distance = distance;
          de.dataset.eta = etaText;
          de.dataset.estdate = estDate;
        } else {
          document.getElementById("deliveryEstimate").innerText = "ðŸ“ Pincode found, but no distance data.";
        }
      }
    });
  }
});

function payNow() {
  const amount = document.getElementById("amountpaid").value;
  if (amount) {
    window.open(`upi://pay?pa=gamesplanet@upi&pn=GamesPlanet&am=${amount}`, "_blank");
  } else {
    alert("Please enter the amount first.");
  }
}

function sendOrder(){
  let now = new Date();
  let orderId = String(now.getDate()).padStart(2,'0') + String(now.getMonth()+1).padStart(2,'0') + now.getFullYear() +
                String(now.getHours()).padStart(2,'0') + String(now.getMinutes()).padStart(2,'0') + String(now.getSeconds()).padStart(2,'0') + '00';

  const getValue = (id) => document.getElementById(id)?.value || "";
  let delivery = document.getElementById("deliveryEstimate").dataset.final || "";

  let msg = `ðŸŸ¢ *Prepaid Order on WhatsApp*

*Order ID:* ${orderId}
*Name:* ${getValue("name")}
*Mobile:* ${getValue("mobile")}
*Alt Mobile:* ${getValue("altmobile")}
*Email:* ${getValue("email")}
*Address:* ${getValue("address")}
*Landmark:* ${getValue("landmark")}
*Pincode:* ${getValue("pincode")}
*State:* ${getValue("state")}
*District/City:* ${getValue("city")}
*Post office:* ${getValue("postoffice")}

*Product:* ${getValue("product")}
*Variant:* ${getValue("variant")}
*Base Price:* â‚¹${getValue("baseprice")}
*Discount Applied:* â‚¹${getValue("discount")}
*Amount Paid:* â‚¹${getValue("amountpaid")}

${delivery}`; // Final ETA section at bottom

  window.location.href = `https://wa.me/917983624797?text=${encodeURIComponent(msg)}`;
}
</script>

</body>
</html>
